'use strict';var canvas=document.querySelector('canvas'),c=canvas.getContext('2d'),polygons=[],polygonTouch=!1,startX=null,startY=null,pointInPolygon=function(a,b,d){var f,g=d.length-1,h=!1;for(f=0;f<d.length;f++){var l=d[f].x,m=d[g].x,n=d[f].y,o=d[g].y;(n<b&&o>=b||o<b&&n>=b)&&(l<=a||m<=a)&&l+(b-n)/(o-n)*(m-l)<a&&(h=!h),g=f}return h},polygonPoints=function(a,b,d){for(var f=[],g=0;g<a+1;g++)f.push({x:75*Math.sin(Math.PI*(g*(360/a)/180))+b,y:75*Math.cos(Math.PI*(g*(360/a)/180))+d});return f},drawPolygon=function(a){c.clearRect(0,0,500,500);var b=[];return a.forEach(function(d){var f=[];c.save(),c.beginPath(),d.forEach(function(g){c.lineTo(g.x,g.y)}),c.fillStyle='#fff',c.fill(),c.stroke(),c.closePath(),c.restore(),d.forEach(function(g,h){h<d.length-1&&(c.save(),c.translate(g.x,g.y),c.fillStyle='#2c3e50',c.fillRect(-5,-5,10,10),c.restore(),f.push({x:g.x,y:g.y,w:10,h:10,index:h}))}),b.push(f)}),b},rectForEach=function(a,b,d,f){return a.forEach(function(g){f?b>=g.x&&b<=g.x+g.w&&d>=g.y&&d<=g.y+g.h&&(g.down=!0):b>=g.x&&b<=g.x+g.w&&d>=g.y&&d<=g.y+g.h&&g.down&&(g.touch=!0)}),a},init=function(){var a=polygonPoints(5,100,100),b=polygonPoints(3,250,100),d=polygonPoints(6,400,100),f=drawPolygon([a,b,d]);polygons.push({points:a,rects:f[0],polygonTouch:!1}),polygons.push({points:b,rects:f[1],polygonTouch:!1}),polygons.push({points:d,rects:f[2],polygonTouch:!1}),canvas.addEventListener('mousedown',function(g){var h=g.clientX,l=g.clientY,m=h-4,n=l-4;polygons.forEach(function(o,q){if(polygons[polygons.length-1].rects=rectForEach(polygons[polygons.length-1].rects,m,n,!0),pointInPolygon(m,n,polygons[q].points)){var s=polygons[q];polygons.splice(q,1),polygons.push(s),polygons[polygons.length-1].polygonTouch=!0,startX=m,startY=n}else;})}),canvas.addEventListener('mousemove',function(g){var h=g.clientX,l=g.clientY,m=h-4,n=l-4;polygons.forEach(function(o,q){polygons[q].rects=rectForEach(polygons[q].rects,m,n,!1);var s=polygons[q].rects.filter(function(t){return t.touch})[0];s&&(0===s.index?(polygons[q].points[0].x=m,polygons[q].points[0].y=n,polygons[q].points[polygons[q].points.length-1].x=m,polygons[q].points[polygons[q].points.length-1].y=n):(polygons[q].points[s.index].x=m,polygons[q].points[s.index].y=n),drawPolygon(polygons.map(function(_ref){var t=_ref.points;return t}))),polygons[q].polygonTouch&&!s&&(polygons[q].points.forEach(function(t){t.x+=m-startX,t.y+=n-startY}),drawPolygon(polygons.map(function(_ref2){var t=_ref2.points;return t})),startX=m,startY=n)})}),canvas.addEventListener('mouseout',function(){f.forEach(function(){})}),canvas.addEventListener('mouseup',function(g){var h=g.clientX,l=g.clientY,m=h-4,n=l-4;polygons.forEach(function(o,q){var s=polygons[q].rects.filter(function(t){return t.touch})[0];polygons[q].polygonTouch&&!s&&(polygons[q].points.forEach(function(t){t.x+=m-startX,t.y+=n-startY}),polygons[q].rects=drawPolygon(polygons.map(function(_ref3){var t=_ref3.points;return t}))[q]),polygons[q].polygonTouch=!1,s&&(polygons[q].rects[s.index].touch=!1,polygons[q].rects[s.index].down=!1,0===s.index?(polygons[q].points[0].x=m,polygons[q].points[0].y=n,polygons[q].points[polygons[q].points.length-1].x=m,polygons[q].points[polygons[q].points.length-1].y=n):(polygons[q].points[s.index].x=m,polygons[q].points[s.index].y=n),polygons[q].rects=drawPolygon(polygons.map(function(_ref4){var t=_ref4.points;return t}))[q])})})};init();
